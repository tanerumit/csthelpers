% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_climate_surface.R
\name{climate_surface_gcm_overlay}
\alias{climate_surface_gcm_overlay}
\title{Overlay GCM information on a climate response surface plot}
\usage{
climate_surface_gcm_overlay(
  p,
  gcm_data = NULL,
  x_var = NULL,
  y_var = NULL,
  scenario_var = "scenario",
  horizon_var = "horizon",
  scenario_levels = NULL,
  horizon_levels = NULL,
  scenario_colors = c(ssp126 = "#003466", ssp245 = "#f69320", ssp370 = "#df0000", ssp585
    = "#980002"),
  horizon_shapes = c(near = 1, far = 4),
  alpha = 0.75,
  size = 1,
  stroke = 1,
  show_legend = TRUE,
  spread_method = c("none", "ellipse_norm", "ellipse_robust", "kde"),
  spread_levels = NULL,
  spread_group = c("none", "scenario", "horizon", "scenario_horizon"),
  spread_color = "gray30",
  spread_linetype = "dashed",
  spread_linewidth = 0.5,
  kde_bw_method = c("auto", "plugin", "nrd"),
  kde_n = 120L,
  kde_bw_adjust = 1
)
}
\arguments{
\item{p}{A ggplot object, typically returned by \code{\link{climate_surface_base}}.}

\item{gcm_data}{A data frame containing GCM summary points. At minimum, this must include
numeric columns for the x- and y-axes (e.g. precipitation and temperature
changes), and categorical columns defining scenarios and time horizons.}

\item{x_var, y_var}{Names of the x and y columns in \code{gcm_data}. If \code{NULL}, these are
inferred from attributes attached to \code{p} by
\code{climate_surface_base}.}

\item{scenario_var}{Name of the column in \code{gcm_data} identifying emission scenarios
(e.g. \code{"ssp126"}, \code{"ssp245"}).}

\item{horizon_var}{Name of the column in \code{gcm_data} identifying time horizons
(e.g. \code{"near"}, \code{"far"}).}

\item{scenario_levels}{Optional character vector specifying which scenarios to include and their
plotting order. If supplied, scenarios not listed are dropped.}

\item{horizon_levels}{Optional character vector specifying which horizons to include and their
plotting order.}

\item{scenario_colors}{Named character vector mapping scenario names to colors. Names must match the
values (or factor levels) in \code{scenario_var}.}

\item{horizon_shapes}{Named integer vector mapping horizon names to point shapes. Names must match
the values (or factor levels) in \code{horizon_var}.}

\item{alpha}{Transparency of GCM points (0--1). Useful for dense ensembles.}

\item{size}{Point size for GCM markers (ggplot2 units).}

\item{stroke}{Stroke width for GCM point outlines.}

\item{show_legend}{Logical. If \code{FALSE}, suppresses all GCM-related legends (scenario and
horizon), while leaving the surface legend untouched.}

\item{spread_method}{Method for visualizing ensemble spread:
\itemize{
  \item \code{"none"}: No spread visualization (default).
  \item \code{"ellipse_norm"}: Standard Gaussian ellipses.
  \item \code{"ellipse_robust"}: Robust (MCD-based) ellipses.
  \item \code{"kde"}: KDE highest density region contours.
}}

\item{spread_levels}{Numeric vector of probability levels (values strictly between 0 and 1)
for spread visualization. For ellipses, these are confidence levels;
for KDE, these are probability mass levels. Example: \code{c(0.5, 0.9)}.}

\item{spread_group}{Controls grouping for spread estimation:
\itemize{
  \item \code{"none"}: One spread summary using all GCM points.
  \item \code{"scenario"}: Separate summaries per scenario.
  \item \code{"horizon"}: Separate summaries per horizon.
  \item \code{"scenario_horizon"}: Separate summaries for each
        scenario--horizon combination.
}}

\item{spread_color}{Line color for spread visualization.}

\item{spread_linetype}{Line type for spread visualization (e.g. \code{"dashed"}, \code{"solid"}).}

\item{spread_linewidth}{Line width for spread visualization.}

\item{kde_bw_method}{Bandwidth selection method for KDE (only used when \code{spread_method = "kde"}):
\itemize{
  \item \code{"auto"}: Try plug-in first, fall back to NRD.
  \item \code{"plugin"}: Full 2D plug-in bandwidth via \code{ks::Hpi()}.
  \item \code{"nrd"}: Normal reference distribution via \code{MASS::bandwidth.nrd()}.
}}

\item{kde_n}{Grid resolution for KDE (integer >= 40). Only used when
\code{spread_method = "kde"}.}

\item{kde_bw_adjust}{Bandwidth adjustment factor for KDE (multiplier > 0). Only used when
\code{spread_method = "kde"}.}
}
\value{
A ggplot object consisting of the original climate response surface with
GCM points and optional spread summaries overlaid.
}
\description{
Adds Global Climate Model (GCM) summary information---typically scenario--horizon
change signals---to an existing climate response surface created with
\code{\link{climate_surface_base}}.

The function overlays:
\itemize{
  \item GCM points positioned in the same \code{(x, y)} climate-change space
        as the response surface (e.g. \eqn{\Delta}precipitation vs
        \eqn{\Delta}temperature),
  \item scenario-specific colors and horizon-specific point shapes,
  \item optional spread summaries via ellipses or KDE highest density regions.
}

The underlying response surface is \strong{not modified}; this function only adds
new ggplot layers and legend entries.
}
\details{
\strong{Facet compatibility:} If the base surface plot is faceted
(via \code{facet_by} in \code{climate_surface_base}), the same facet variable
must be present in \code{gcm_data}. Otherwise, GCM points will be recycled
into all panels.

\strong{Axis consistency:} When available, axis limits stored as attributes
on the base plot (\code{x_breaks}, \code{y_breaks}) are used to clip
\code{gcm_data} before plotting, ensuring GCM points and spread summaries
are confined to the visible plotting domain.

\strong{Spread methods:}
\itemize{
  \item \code{"none"}: No spread visualization.
  \item \code{"ellipse_norm"}: Standard Gaussian ellipses via \code{stat_ellipse()}.
  \item \code{"ellipse_robust"}: Robust ellipses using Minimum Covariance
        Determinant (MCD) via \code{MASS::cov.rob()}, less sensitive to outliers.
  \item \code{"kde"}: Kernel density estimation highest density regions (HDR)
        with optional plug-in bandwidth selection via \code{ks::Hpi()}.
}
}
\examples{
\dontrun{
# Basic overlay with points only
climate_surface_gcm_overlay(p, gcm_data)

# With Gaussian ellipses at 50\% and 90\% confidence
climate_surface_gcm_overlay(p, gcm_data,
  spread_method = "ellipse_norm",
  spread_levels = c(0.5, 0.9))

# With robust ellipses grouped by scenario
climate_surface_gcm_overlay(p, gcm_data,
  spread_method = "ellipse_robust",
  spread_levels = 0.9,
  spread_group = "scenario")

# With KDE HDR contours
climate_surface_gcm_overlay(p, gcm_data,
  spread_method = "kde",
  spread_levels = c(0.5, 0.9),
  kde_bw_method = "plugin")
}

}
\seealso{
\code{\link{climate_surface_base}}, \code{\link[ggplot2]{stat_ellipse}}
}
