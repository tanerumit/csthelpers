% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/calculate_erfa_class.R
\name{calculate_erfa_class}
\alias{calculate_erfa_class}
\title{Calculate Environmental Flow Risk Assessment (ERFA) Class}
\usage{
calculate_erfa_class(baseline_tbl, scenario_tbl, sensi_threshold = 30)
}
\arguments{
\item{baseline_tbl}{A data frame returned by [calc_eflow_metrics()] representing
the baseline (reference) discharge scenario.}

\item{scenario_tbl}{A data frame returned by [calc_eflow_metrics()] representing
the scenario to compare against the baseline.}

\item{sensi_threshold}{Numeric; sensitivity threshold for percent change (default = 30).
Indicators with an absolute percent change greater than this threshold
are considered â€œdifferentâ€ (sensitive).}
}
\value{
A list with two data frames:
\describe{
  \item{detail}{
    Per-indicator comparison table with baseline and scenario values,
    percent change, and logical flag (`outside_range`) indicating if
    the change exceeds the threshold.
  }
  \item{summary}{
    Summary table by group and overall, containing:
    \itemize{
      \item `group` â€” indicator group (HF, MF, LF, RFC, IF, Overall)
      \item `n_total` â€” total indicators in the group
      \item `n_outside` â€” count of indicators outside threshold
      \item `perc_outside` â€” percent of indicators outside threshold
      \item `risk_class` â€” numeric class code (0â€“3)
      \item `risk_label` â€” descriptive label with color code
    }
  }
}
}
\description{
Compares the 70 eco-hydrological indicators (from `calc_eflow_metrics()`)
between two discharge scenarios (e.g., baseline and future) and classifies
the environmental flow (E-flow) risk for each indicator group and overall.
}
\details{
The function calculates percent change for each indicator:
\deqn{pct\_change = 100 * (value_{scenario} - value_{baseline}) / value_{baseline}}

Indicators whose absolute percent change exceeds the sensitivity threshold
are counted as â€œdifferentâ€. The counts are summarized by indicator group
(HF, MF, LF, RFC, IF) and overall. Based on the number of indicators outside
the threshold range, the function assigns an environmental flow risk class.

### Risk classification thresholds

| group | 0 (No change) | 1 (Low) | 2 (Medium) | 3 (High) |
|--------|---------------|---------|-------------|-----------|
| **Overall** | 0 | 1â€“22 | 23â€“46 | 47â€“70 |
| **HF** | 0 | 1â€“5 | 6â€“10 | 11â€“16 |
| **MF** | 0 | 1â€“8 | 9â€“16 | 17â€“24 |
| **LF** | 0 | 1â€“5 | 6â€“10 | 11â€“16 |
| **RFC** | 0 | 1â€“2 | 3â€“5 | 6â€“8 |
| **IF** | 0 | 1â€“2 | 3â€“4 | 5â€“6 |

Risk class codes and suggested colors:
\itemize{
  \item 0 = No change â€” ğŸŸ¦ Blue
  \item 1 = Low risk â€” ğŸŸ© Green
  \item 2 = Medium risk â€” ğŸŸ§ Amber
  \item 3 = High risk â€” ğŸŸ¥ Red
}
}
\examples{
\dontrun{
set.seed(42)
dates <- seq.Date(as.Date("2000-01-01"), as.Date("2019-12-31"), by = "day")
Q_base <- pmax(0, 40 + 15*sin(2*pi*(1:length(dates))/365) + rnorm(length(dates),0,5))
Q_fut  <- pmax(0, 42 + 17*sin(2*pi*(1:length(dates))/365) + rnorm(length(dates),0,6))

base_tbl <- calc_eflow_metrics(Q_base, dates)
scen_tbl <- calc_eflow_metrics(Q_fut,  dates)

erfa <- calculate_erfa_class(base_tbl, scen_tbl, sensi_threshold = 30)
erfa$summary
}

}
