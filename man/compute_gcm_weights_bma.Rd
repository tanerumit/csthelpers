% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/gcm_weights_pi.R
\name{compute_gcm_weights_bma}
\alias{compute_gcm_weights_bma}
\title{Compute PIW (Performanceâ€“Independence Weighting) ensemble weights}
\usage{
compute_gcm_weights_bma(
  gcm_data,
  skill_data = NULL,
  obs_data = NULL,
  kuma_table = NULL,
  model_col = "model",
  scenario_col = "scenario",
  skill_col = "skill",
  target_col = NULL,
  prior_method = c("genealogy", "genealogy_sqrt", "institution", "uniform"),
  institution_col = "institution",
  skill_metric = c("rmse", "correlation", "bias", "nse"),
  likelihood_transform = c("gaussian", "softmax", "rank", "linear"),
  skill_weight = 0.5,
  min_weight = 0.001,
  verbose = TRUE,
  temperature = NULL,
  robust_scale = c("sd", "mad"),
  include_missing_skill = FALSE,
  skill_weight_grid = seq(0, 1, by = 0.25)
)
}
\arguments{
\item{gcm_data}{data.frame containing at least `model_col` and `scenario_col`.}

\item{skill_data}{Optional data.frame with per-model (or per-model-scenario)
skill in `skill_col`.}

\item{obs_data}{Optional data.frame of observations used to compute skill
when `skill_data` is NULL.}

\item{kuma_table}{Required for genealogy priors; passed to
`compute_gcm_weights_by_genealogy()`.}

\item{model_col}{Character scalar column name identifying model.}

\item{scenario_col}{Character scalar column name identifying scenario.}

\item{skill_col}{Character scalar skill column name in `skill_data`.}

\item{target_col}{Character scalar target column name in `gcm_data`/`obs_data`
required when computing skill from observations.}

\item{prior_method}{Structural weighting method: `"genealogy"`,
`"genealogy_sqrt"`, `"institution"`, or `"uniform"`.}

\item{institution_col}{Character scalar institution column in `gcm_data`
required when `prior_method = "institution"`.}

\item{skill_metric}{Skill metric used for performance weighting: `"rmse"`,
`"correlation"`, `"bias"`, or `"nse"`.}

\item{likelihood_transform}{Preference transform mapping skill to weights:
`"gaussian"`, `"softmax"`, `"rank"`, or `"linear"`.}

\item{skill_weight}{Numeric scalar in [0,1] controlling the blend between
structure-only (0) and skill-only (1).}

\item{min_weight}{Numeric scalar in (0,1) used to regularize near-zero weights.}

\item{verbose}{Logical; if TRUE prints progress and summary diagnostics.}

\item{temperature}{Optional numeric scalar > 0 controlling transform sharpness;
if NULL it is estimated from skill dispersion using `robust_scale`.}

\item{robust_scale}{Robust scale estimator used when `temperature` is NULL:
`"sd"` or `"mad"`.}

\item{include_missing_skill}{Logical; if FALSE drops models without finite
skill values, else retains them with minimal regularized influence.}

\item{skill_weight_grid}{Optional numeric vector of values in [0,1] used to
compute sensitivity diagnostics; NULL disables sensitivity output.}
}
\value{
A data.frame with columns:
\itemize{
  \item model, scenario
  \item w_prior (structural), w_likelihood (skill), w_bma (PIW combined)
  \item skill_value, w_structure_only, w_skill_only
}
Additional diagnostics are attached as attributes:
\itemize{
  \item attr(result, "piw_diagnostics")
  \item attr(result, "piw_sensitivity")
}
}
\description{
Computes decision weights for climate model ensembles by combining a
structural (independence) component with a performance (skill) component.
}
\details{
The function estimates model-level skill (aggregated across scenarios by
default) and applies that performance weighting across scenarios, then blends
with structural weights per scenario via a log-space geometric mixture
controlled by `skill_weight`.

Structural priors require external package helpers for genealogy/institution
priors; uniform structural weights are computed internally.
}
\examples{
\dontrun{
w <- compute_gcm_weights_bma(
  gcm_data = gcm,
  skill_data = skill,
  prior_method = "institution",
  skill_metric = "rmse",
  likelihood_transform = "gaussian",
  skill_weight = 0.5
)
attr(w, "piw_diagnostics")
}

}
